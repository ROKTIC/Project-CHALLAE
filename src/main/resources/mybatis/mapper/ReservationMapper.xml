<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.springmvc.domain.reservation.mapper.ReservationMapper">
    <!-- 예약정보를 DB에 저장하는 SQL문-->
    <insert id="insertReservation" parameterType="com.ezen.springmvc.domain.reservation.dto.ReservationDto">
        INSERT INTO RESERVATION (RES_NUM, RES_RESDATE, RES_PRICE, MEMBER_NUM, RES_TIME, RES_MEMO)
        VALUES (NULL, STR_TO_DATE(#{resDate}, '%Y-%m-%d'), #{resPrice}, #{memberNum}, #{resTime}, #{resMemo})

        <selectKey keyProperty="resNum" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 예약번호 찾기 SQL문 -->
    <select id="findByReservationNum" resultType="com.ezen.springmvc.domain.reservation.dto.ReservationDto">
        SELECT  M.MEMBER_NAME, M.MEMBER_PHONE,
                R.RES_TIME, DATE_FORMAT(R.RES_RESDATE, '%Y-%m-%d') AS resDate, R.RES_PRICE, R.RES_MEMO
        FROM MEMBER M
                 JOIN RESERVATION R ON M.MEMBER_NUM = R.MEMBER_NUM
        WHERE R.RES_NUM = #{resNum}
    </select>

    <!-- membernum을 찾는 SQL문 -->
    <select id="findByMemberNum" parameterType="int" resultType="MemberDto">
        SELECT MEMBER_NAME AS "name", MEMBER_PHONE AS "phone"
        FROM MEMBER
        WHERE MEMBER_NUM = #{value}
    </select>
</mapper>
